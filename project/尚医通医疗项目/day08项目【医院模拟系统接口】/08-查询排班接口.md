# 一、查询排班接口

参考《尚医通API接口文档.docx》业务接口4.6查询医院

一个科室有多个科室，因此我们采取分页查询方式

## 1、添加service接口和实现

```java
/**
 * 分页查询
 * @param page 当前页码
 * @param limit 每页记录数
 * @param scheduleQueryVo 查询条件
 * @return
 */
Page<Schedule> selectPage(Integer page, Integer limit, ScheduleQueryVo scheduleQueryVo);

@Override
public Page<Schedule> selectPage(Integer page, Integer limit, ScheduleQueryVo scheduleQueryVo) {
    Sort sort = Sort.by(Sort.Direction.DESC, "createTime");
    //0为第一页
    Pageable pageable = PageRequest.of(page-1, limit, sort);

    Schedule schedule = new Schedule();
    BeanUtils.copyProperties(scheduleQueryVo, schedule);
    schedule.setIsDeleted(0);

    //创建匹配器，即如何使用查询条件
    ExampleMatcher matcher = ExampleMatcher.matching() //构建对象
        .withStringMatcher(ExampleMatcher.StringMatcher.CONTAINING) //改变默认字符串匹配方式：模糊查询
        .withIgnoreCase(true); //改变默认大小写忽略方式：忽略大小写

    //创建实例
    Example<Schedule> example = Example.of(schedule, matcher);
    Page<Schedule> pages = scheduleRepository.findAll(example, pageable);
    return pages;
}
```

## 2、添加controller接口

```
@ApiOperation(value = "获取排班分页列表")
@PostMapping("schedule/list")
public Result schedule(HttpServletRequest request) {
    Map<String, Object> paramMap = HttpRequestHelper.switchMap(request.getParameterMap());
    //必须参数校验 略
    String hoscode = (String)paramMap.get("hoscode");
    //非必填
    String depcode = (String)paramMap.get("depcode");
    int page = StringUtils.isEmpty(paramMap.get("page")) ? 1 : Integer.parseInt((String)paramMap.get("page"));
    int limit = StringUtils.isEmpty(paramMap.get("limit")) ? 10 : Integer.parseInt((String)paramMap.get("limit"));

    ScheduleQueryVo scheduleQueryVo = new ScheduleQueryVo();
    scheduleQueryVo.setHoscode(hoscode);
    scheduleQueryVo.setDepcode(depcode);
    Page<Schedule> pageModel = scheduleService.selectPage(page , limit, scheduleQueryVo);
    return Result.ok(pageModel);
}
```
